#ifndef __PATCH_UTILS_H__
#define __PATCH_UTILS_H__

#include <ppu-lv2.h>
#include <hvcall.h>

#include "mm.h"

#define FW_341_ADDR  0x80000000002d7580
#define FW_341_VALUE 0x0000000000008534
#define FW_355_ADDR  0x80000000003329b8
#define FW_355_VALUE 0x0000000000008aac
#define FW_UNK_VALUE 0

#define SYSCALL_TABLE_341			0x80000000002EB128ULL	// 3.41
#define SYSCALL_TABLE_355			0x8000000000346570ULL	// 3.55
#define SYSCALL_TABLE_355D			0x8000000000361578ULL	// 3.55 DEX
#define SYSCALL_TABLE_421			0x800000000035BCA8ULL	// 4.21
#define SYSCALL_TABLE_421D			0x800000000037A1B0ULL	// 4.21 DEX
#define SYSCALL_TABLE_430			0x800000000035DBE0ULL	// 4.30
#define SYSCALL_TABLE_430D			0x800000000037C068ULL	// 4.30 DEX
#define SYSCALL_TABLE_431			0x800000000035DBE0ULL	// 4.31
#define SYSCALL_TABLE_440			0x800000000035E260ULL	// 4.40
#define SYSCALL_TABLE_441			0x800000000035E260ULL	// 4.41
#define SYSCALL_TABLE_441D			0x800000000037C9E8ULL	// 4.41 DEX
#define SYSCALL_TABLE_446			0x800000000035E860ULL	// 4.46
#define SYSCALL_TABLE_446D			0x800000000037CFE8ULL	// 4.46 DEX
#define SYSCALL_TABLE_450			0x800000000035F0D0ULL	// 4.50
#define SYSCALL_TABLE_450D			0x8000000000383658ULL	// 4.50 DEX
#define SYSCALL_TABLE_453			0x800000000035F300ULL	// 4.53
#define SYSCALL_TABLE_453D			0x8000000000385108ULL	// 4.53 DEX
#define SYSCALL_TABLE_455			0x8000000000362680ULL	// 4.55
#define SYSCALL_TABLE_455D			0x8000000000388488ULL	// 4.55 DEX
#define SYSCALL_TABLE_460			0x8000000000363A18ULL	// 4.60
#define SYSCALL_TABLE_465			0x8000000000363A18ULL	// 4.65
#define SYSCALL_TABLE_465D			0x800000000038A120ULL	// 4.65 DEX
#define SYSCALL_TABLE_470			0x8000000000363B60ULL 	// 4.70
#define SYSCALL_TABLE_470D			0x800000000038A368ULL 	// 4.70 DEX
#define SYSCALL_TABLE_475			0x8000000000363BE0ULL	// 4.75
#define SYSCALL_TABLE_475D			0x800000000038A3E8ULL 	// 4.75 DEX
#define SYSCALL_TABLE_480			0x8000000000363BE0ULL	// 4.80
#define SYSCALL_TABLE_480D			0x800000000038A4E8ULL	// 4.80 DEX
#define SYSCALL_TABLE_481			0x8000000000363BE0ULL	// 4.81
#define SYSCALL_TABLE_481D			0x800000000038A4E8ULL	// 4.81 DEX
#define SYSCALL_TABLE_481H			0x80000000003B28F8ULL	// 4.81 DEH
#define SYSCALL_TABLE_482			0x8000000000363BE0ULL	// 4.82
#define SYSCALL_TABLE_482D			0x800000000038A4E8ULL	// 4.82 DEX


#define SYSCALL_PTR(n)				( (SYSCALL_TABLE) + ( 8 * (n) ) )

u64 mmap_lpar_addr;

u64 lv2peek(u64 addr);
void lv2poke(u64 addr, u64 value);
void lv2poke32(u64 addr, u32 value);

void lv1poke(u64 addr, u64 value);

u64 lv1peek2(u64 addr);
void lv1poke2(u64 addr, u64 value);

int map_lv1();
void unmap_lv1(void);

void patch_lv2_protection();

void install_new_poke();
void remove_new_poke();

int remove_protection();

//int get_version();

#endif
